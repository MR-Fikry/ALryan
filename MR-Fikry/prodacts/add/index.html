<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<title>ุงูุฑูุงู ููุงุฏูุงุช ุงูููุฒููู</title>

<!-- Basic SEO -->
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="robots" content="index, follow">
<meta name="theme-color" content="#000000">

<!-- Open Graph (Social Media) -->
<meta property="og:title" content="">
<meta property="og:description" content="">
<meta property="og:image" content="https://alryan.pages.dev/icon.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://alryan.pages.dev/">
<meta property="og:type" content="website">
<meta property="og:locale" content="ar_AR">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://alryan.pages.dev/icon.jpg">

<!-- PWA / Mobile App Feel -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="OS Store">
<link rel="apple-touch-icon" href="https://alryan.pages.dev/icon.jpg">

<!-- Preload main resources (ุณุฑุนุฉ ุฃุนูู) -->
<link rel="preload" as="image" href="https://alryan.pages.dev/icon.jpg">

<link rel="preload" as="style" href="style.css">

<!-- CSS + Icons -->
<link rel="icon" href="https://alryan.pages.dev/icon.jpg" type="image/png">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- Security Headers (ุฎูููุฉ ุจุฏูู ุณูุฑูุฑ) -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
</head>
<body>

    <header>
<h1>ุงูุฑูุงู ููุงุฏูุงุช ุงูููุฒููู</h1>
<img src="https://alryan.pages.dev/logo.png" class="logo">
</header>
  
    <div class="bu">
      <a href="/MR-Fikry/prodacts/" class="go">ุงุถุงูู ููุชุฌุงุช</a>
      <a href="" class="activ" >ุนุฑุถ ุงูููุชุฌุงุช</a>
    </div>

    <div class="low-stock-header">
  <button id="lowStockBtn" onclick="toggleLowStock()">
    โ๏ธ ุงูููุชุฌุงุช ุงููุงูุตุฉ
  </button>
  <span id="lowStockCount" class="count-badge">0</span>
</div>

<div id="lowStockBox" class="low-stock-box" style="display:none"></div>

<hr style="margin:30px 0">


<h2>ุงูููุชุฌุงุช</h2>


<input type="text" id="search" placeholder=" ุงุจุญุซ ุจุงูุงุณู ุฃู ุงูุณูุฑูุงู">

<table>
  <tbody id="products"></tbody>
</table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDuwURf9DxvGlEIox6J92iPF9-lmnKETH8",
    authDomain: "login-employees1.firebaseapp.com",
    projectId: "login-employees1",
    storageBucket: "login-employees1.firebasestorage.app",
    messagingSenderId: "907414298566",
    appId: "1:907414298566:web:0141762effe0e9ff289cc7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const tbody = document.getElementById('products');

 const LOW_STOCK_LIMIT = 2;
const lowStockBox = document.getElementById("lowStockBox");
const lowStockCount = document.getElementById("lowStockCount");

async function loadProducts() {
  const querySnapshot = await getDocs(collection(db, 'products'));
  tbody.innerHTML = '';
  lowStockBox.innerHTML = '';

  let lowCount = 0;

  querySnapshot.forEach((docSnap) => {
    const p = docSnap.data();

    /* ===== ุงููุงุฑุช ุงูุนุงุฏู ===== */
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>
        <div class="product-card ${p.quantity <= LOW_STOCK_LIMIT ? 'low-stock' : ''}"
             data-name="${p.name}" data-serial="${p.serial}">
          
          <div class="product-name" onclick="toggleDetails('${docSnap.id}')">
            ${p.name}
            <span>ุงููููุฉ: ${p.quantity}</span>
          </div>

          <div class="product-details" id="details-${docSnap.id}">
            <label>ุงูุณูุฑูุงู</label>
            <input value="${p.serial}" id="serial-${docSnap.id}">

            <label>ุณุนุฑ ุงูุดุฑุงุก</label>
            <input type="number" value="${p.buyPrice}" id="buy-${docSnap.id}">

            <label>ุณุนุฑ ุงูุจูุน</label>
            <input type="number" value="${p.sellPrice}" id="sell-${docSnap.id}">

            <label>ุงููููุฉ</label>
            <input type="number" value="${p.quantity}" id="qty-${docSnap.id}">

            <button onclick="save('${docSnap.id}')">๐พ ุญูุธ</button>
            <button class="delete-btn" onclick="removeProduct('${docSnap.id}', '${p.name}')">
              ๐๏ธ ุญุฐู ุงูููุชุฌ
            </button>

          </div>
        </div>
      </td>
    `;
    tbody.appendChild(tr);

    /* ===== ุงูููุชุฌุงุช ุงููุงูุตุฉ (ููุณ ุงููุงุฑุช) ===== */
    if (p.quantity <= LOW_STOCK_LIMIT) {
      lowCount++;

      lowStockBox.innerHTML += `
        <div class="product-card low-stock">
          <div class="product-name">
            โ๏ธ ${p.name}
            <span>ุงููููุฉ ุงููุชุจููุฉ: ${p.quantity}</span>
            <span>ุงูุณูุฑูุงู: ${p.serial}</span>
          </div>
        </div>
      `;
    }
  });

  /* ุชุญุฏูุซ ุงูุนุฏูุงุฏ */
  lowStockCount.textContent = lowCount;

  if (lowCount === 0) {
    lowStockBox.innerHTML = `<p class="empty">ูุง ููุฌุฏ ููุชุฌุงุช ูุงูุตุฉ ๐</p>`;
  }
}


window.toggleLowStock = function(){
  const box = document.getElementById("lowStockBox");
  box.style.display = box.style.display === "none" ? "grid" : "none";
};
  

  window.toggleDetails = (id) => {
    const el = document.getElementById(`details-${id}`);
    el.style.display = el.style.display === 'block' ? 'none' : 'block';
  };

  window.save = async (id) => {
    await updateDoc(doc(db, 'products', id), {
      buyPrice: Number(document.getElementById(`buy-${id}`).value),
      sellPrice: Number(document.getElementById(`sell-${id}`).value),
      quantity: Number(document.getElementById(`qty-${id}`).value),
      serial: document.getElementById(`serial-${id}`).value,
    });
    alert('ุชู ุญูุธ ุงูุชุนุฏููุงุช โ');
  }; 

  window.removeProduct = async (id, name) => {
  const ok = confirm(`โ๏ธ ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูููุชุฌ:\n${name} ุ`);

  if (!ok) return;

  try {
    await deleteDoc(doc(db, 'products', id));
    alert('ุชู ุญุฐู ุงูููุชุฌ ุจูุฌุงุญ โ');
    loadProducts(); // ุฅุนุงุฏุฉ ุชุญููู ุงููุงุฆูุฉ
  } catch (e) {
    alert('ุญุตู ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู โ');
    console.error(e);
  }
};


  document.getElementById('search').addEventListener('input', function () {
  const value = this.value.toLowerCase();

  document.querySelectorAll('#products tr').forEach(tr => {
    const card = tr.querySelector('.product-card');
    if (!card) return;

    const name = (card.dataset.name || '').toLowerCase();
    const serial = (card.dataset.serial || '').toLowerCase();

    tr.style.display =
      name.includes(value) || serial.includes(value)
        ? ''
        : 'none';
  });
});


  loadProducts();
</script>

</body>
</html>
